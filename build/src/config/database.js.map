{"version":3,"file":"database.js","names":["_fs","_interopRequireDefault","require","_sequelize","_path","_config","e","__esModule","default","dirname","path","resolve","Database","constructor","models","databaseOptions","dialect","config","host","port","username","password","database","define","timezone","logging","minifyAliases","query","raw","_instance","Sequelize","_loadModels","console","log","fs","readdirSync","withFileTypes","filter","entry","statSync","name","isFile","map","forEach","filePath","Model","load","_instantiateModels","Object","values","model","associate","sequelize","_authenticate","authenticate","then","catch","error","disconnect","close","connect","_default","exports"],"sources":["../../../src/config/database.js"],"sourcesContent":["import fs from \"fs\";\nimport Sequelize from \"sequelize\";\nimport path from \"path\";\n\nimport config from \"./config\";\n\nconst dirname = path.resolve('./');\n\nclass Database {\n\tconstructor() {\n\t\tthis.models = {};\n\t\tthis.databaseOptions = {\n\t\t\tdialect: config.dialect,\n\t\t\thost: config.host,\n\t\t\tport: config.port,\n\t\t\tusername: config.username,\n\t\t\tpassword: config.password,\n\t\t\tdatabase: config.database,\n\t\t\tdefine: config.define,\n\t\t\ttimezone: config.timezone,\n\t\t\tlogging: false,\n\t\t\tminifyAliases: true,\n\t\t\tquery: {\n\t\t\t\traw: true,\n\t\t\t},\n\t\t};\n\n\t\tthis._instance = new Sequelize(\n\t\t\tthis.databaseOptions.database,\n\t\t\tthis.databaseOptions.username,\n\t\t\tthis.databaseOptions.password,\n\t\t\tthis.databaseOptions\n\t\t);\n\t}\n\n\t_loadModels() {\n\t\tconsole.log(dirname, 'dirname')\n\t\tfs.readdirSync(`${dirname}/src/models`, { withFileTypes: true })\n\t\t\t.filter((entry) => {\n\t\t\t\tconsole.log(entry, 'entry');\n\t\t\t\tfs.statSync(`${dirname}/src/models/${entry.name}`).isFile()\n\t\t\t}\n\t\t\t)\n\t\t\t.map((entry) => `${dirname}/src/models/${entry.name}`)\n\t\t\t.forEach((filePath) => {\n\t\t\t\tconst Model = require(filePath).default;\n\n\t\t\t\tif (!Model || Model.name === \"BaseModel\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.models[Model.name] = Model.load(this._instance, Sequelize);\n\t\t\t});\n\t}\n\n\t_instantiateModels() {\n\t\tObject.values(this.models)\n\t\t\t.filter((model) => typeof model.associate === \"function\")\n\t\t\t.forEach((model) => {\n\t\t\t\tmodel.models = this.models;\n\t\t\t\tmodel.sequelize = this._instance;\n\t\t\t\tmodel.associate(this.models);\n\t\t\t});\n\t}\n\n\t_authenticate() {\n\t\treturn this._instance\n\t\t\t.authenticate()\n\t\t\t.then(() => console.log(\"Database is connected\"))\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.log(`Database connection error: ${error}`);\n\t\t\t\tthrow error;\n\t\t\t});\n\t}\n\n\tdisconnect() {\n\t\treturn this._instance\n\t\t\t.close()\n\t\t\t.then(() => console.log(\"Database is disconnected\"))\n\t\t\t.catch((error) =>\n\t\t\t\tconsole.log(`Database disconnection error: ${error}`)\n\t\t\t);\n\t}\n\n\tconnect() {\n\t\tthis._loadModels();\n\t\tthis._instantiateModels();\n\n\t\treturn this._authenticate();\n\t}\n}\n\nexport default Database;"],"mappings":"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","ignoreList":[]}