"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _fs=_interopRequireDefault(require("fs"));var _sequelize=_interopRequireDefault(require("sequelize"));var _path=_interopRequireDefault(require("path"));var _config=_interopRequireDefault(require("./config"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const dirname=_path.default.resolve("./");class Database{constructor(){this.models={};this.databaseOptions={dialect:_config.default.dialect,host:_config.default.host,port:_config.default.port,username:_config.default.username,password:_config.default.password,database:_config.default.database,define:_config.default.define,timezone:_config.default.timezone,logging:false,minifyAliases:true,query:{raw:true}};this._instance=new _sequelize.default(this.databaseOptions.database,this.databaseOptions.username,this.databaseOptions.password,this.databaseOptions)}_loadModels(){console.log(dirname,"dirname");_fs.default.readdirSync(`${dirname}/src/models`,{withFileTypes:true}).filter(entry=>{console.log(entry,"entry");_fs.default.statSync(`${dirname}/src/models/${entry.name}`).isFile()}).map(entry=>`${dirname}/src/models/${entry.name}`).forEach(filePath=>{const Model=require(filePath).default;if(!Model||Model.name==="BaseModel"){return}this.models[Model.name]=Model.load(this._instance,_sequelize.default)})}_instantiateModels(){Object.values(this.models).filter(model=>typeof model.associate==="function").forEach(model=>{model.models=this.models;model.sequelize=this._instance;model.associate(this.models)})}_authenticate(){return this._instance.authenticate().then(()=>console.log("Database is connected")).catch(error=>{console.log(`Database connection error: ${error}`);throw error})}disconnect(){return this._instance.close().then(()=>console.log("Database is disconnected")).catch(error=>console.log(`Database disconnection error: ${error}`))}connect(){this._loadModels();this._instantiateModels();return this._authenticate()}}var _default=exports.default=Database;
//# sourceMappingURL=database.js.map